<!-- templates/dashboard.html -->
<!DOCTYPE html>
<html>

<head>
    <title>Dashboard</title>
    <link type="text/css" rel="stylesheet" href="/static/jsgrid/dist/jsgrid.min.css" />
    <link type="text/css" rel="stylesheet" href="/static/jsgrid/dist/jsgrid-theme.min.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/static/jsgrid/dist/jsgrid.min.js"></script>
</head>

<body>
    
    <h2 style="text-align:center;">Company License Management</h2>
    
    <div id="jsGrid" style="width:90%;margin:auto;"></div>

    <script>
        $("#jsGrid").jsGrid({
            width: "100%",
            height: "auto",
            inserting: true,
            editing: true,
            sorting: true,
            paging: true,
            autoload: true,
            filtering: true,       // ✅ corrected key
            autosearch: true,      // ✅ triggers filter as user types
            autoload: true,
            controller: {
                loadData: filter => fetch("/all/filter", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(filter)
                }).then(res => res.json()),

                insertItem: item => fetch("/all/create", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(item)
                }).then(res => {
                    $("#jsGrid").jsGrid("loadData");
                    return res.json();
                }),

                updateItem: item => fetch("/all/update", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(item)
                }).then(res => {
                    $("#jsGrid").jsGrid("loadData");
                    return res.json();
                }),

                deleteItem: item => fetch(`/all/delete/${item.company_id}`, {
                    method: "DELETE"
                }).then(res => {
                    $("#jsGrid").jsGrid("loadData");
                    return res.json();
                })
            },


            fields: [
                { name: "company_name", type: "text", title: "Company", width: 100 },
                { name: "company_id_number", type: "text", title: "ID Number", width: 100 },
                { name: "mobile_number", type: "text", title: "Mobile", width: 80 },
                { name: "email", type: "text", title: "Email", width: 120 },
                { name: "director", type: "text", title: "Director", width: 80 },
                { name: "measurer_company", type: "text", title: "Measurer", width: 80 },
                { name: "machine_serial_number", type: "text", title: "Serial", width: 100 },
                { name: "measurer_computer", type: "text", title: "PC Measurer", width: 80 },
                { name: "price", type: "number", title: "Price", width: 50 },
                { name: "paid", type: "checkbox", title: "Paid", width: 40 },
                {
                    name: "expire_date",
                    title: "Expire Date",
                    type: "date",
                    width: 90,
                    insertTemplate: function () {
                        this._insertPicker = $("<input>").attr("type", "date").addClass("form-control");
                        return this._insertPicker;
                    },
                    editTemplate: function (value) {
                        this._editPicker = $("<input>").attr("type", "date").addClass("form-control").val(value);
                        return this._editPicker;
                    },
                    insertValue: function () {
                        return this._insertPicker.val();
                    },
                    editValue: function () {
                        return this._editPicker.val();
                    }
                },
                {name: "status", type: "checkbox", title: "Status", width: 80},


                { type: "control" }
            ]
        });
    </script>
</body>

</html>